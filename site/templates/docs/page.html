{% extends "base.html" %}

{% block title %}{{ page.title }} — Context Harness Docs{% endblock %}
{% block description %}{{ page.description | default(value="Context Harness documentation") }}{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ get_url(path='docs.css') }}">
{% endblock %}

{% block body_class %}docs-page{% endblock %}

{% block body %}
<!-- Header -->
<header class="header">
    <div class="header-inner">
        <div class="header-left">
            <button class="menu-btn" onclick="document.querySelector('.sidebar').classList.toggle('open')" aria-label="Menu">☰</button>
            <a href="{{ get_url(path='/') }}" class="header-brand">⚡ Context Harness</a>
            <span class="header-sep">/</span>
            <a href="{{ get_url(path='@/docs/_index.md') }}" class="header-title-link">Docs</a>
        </div>
        <div class="header-links">
            <button class="header-search" id="search-trigger">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="7"/><path d="m21 21-4.35-4.35"/></svg>
                Search
                <kbd>⌘K</kbd>
            </button>
            <a href="{{ get_url(path='/') }}">Home</a>
            <a href="{{ get_url(path='demo/') }}">Demo</a>
            <a href="{{ config.extra.github_url }}" class="gh-link" target="_blank" rel="noopener">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
            </a>
        </div>
    </div>
</header>

<!-- Layout -->
<div class="layout">
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        {% set docs_section = get_section(path="docs/_index.md") %}
        {% set prev_group = "" %}
        {% for p in docs_section.pages | sort(attribute="extra.sidebar_order") %}
        {% if p.extra.sidebar_label is defined %}
            {% set group = p.extra.sidebar_group | default(value="") %}
            {% if group != prev_group and group != "" %}
                {% if prev_group != "" %}</div>{% endif %}
                <div class="nav-group">
                    <div class="nav-group-title">{{ group }}</div>
            {% endif %}
            <a class="nav-link{% if p.permalink == page.permalink %} active{% endif %}" href="{{ p.permalink }}">{{ p.extra.sidebar_label }}</a>
            {% set_global prev_group = group %}
        {% endif %}
        {% endfor %}
        {% if prev_group != "" %}</div>{% endif %}
    </nav>

    <!-- Main Content -->
    <main class="content">
        <h1>{{ page.title }}</h1>
        {% if page.description %}
        <p class="lead">{{ page.description }}</p>
        {% endif %}

        {{ page.content | safe }}

        <!-- Prev / Next navigation -->
        {% set all_pages = docs_section.pages | sort(attribute="extra.sidebar_order") %}
        <div class="page-nav">
            {% set_global found_current = false %}
            {% set_global prev_page = false %}
            {% set_global next_page = false %}
            {% set_global prev_done = false %}
            {% for p in all_pages %}
                {% if p.permalink == page.permalink %}
                    {% set_global found_current = true %}
                {% elif not found_current %}
                    {% set_global prev_page = p %}
                {% elif found_current and not prev_done %}
                    {% set_global next_page = p %}
                    {% set_global prev_done = true %}
                {% endif %}
            {% endfor %}
            <div class="page-nav-inner">
                {% if prev_page %}
                <a href="{{ prev_page.permalink }}" class="page-nav-link prev">
                    <span class="page-nav-dir">← Previous</span>
                    <span class="page-nav-title">{{ prev_page.title }}</span>
                </a>
                {% else %}
                <span></span>
                {% endif %}
                {% if next_page %}
                <a href="{{ next_page.permalink }}" class="page-nav-link next">
                    <span class="page-nav-dir">Next →</span>
                    <span class="page-nav-title">{{ next_page.title }}</span>
                </a>
                {% endif %}
            </div>
        </div>
    </main>
</div>

<script src="{{ get_url(path='ctx-search.js') }}" data-json="{{ get_url(path='docs/data.json') }}" data-trigger="#search-trigger" data-placeholder="Search docs, source code, guides…"></script>
<script>
// Sidebar active tracking for headings
const sections = document.querySelectorAll('.content h2[id], .content h3[id]');
const navLinks = document.querySelectorAll('.nav-link');
navLinks.forEach(link => {
    link.addEventListener('click', () => {
        document.getElementById('sidebar').classList.remove('open');
    });
});
</script>
{% endblock %}

