{% extends "base.html" %}

{% block title %}Documentation — Context Harness{% endblock %}
{% block description %}Complete documentation for Context Harness — local-first context indexing and retrieval for AI tools.{% endblock %}

{% block head_extra %}
<style>
    html { scroll-behavior: smooth; scroll-padding-top: 80px; }

    /* Sidebar */
    .doc-sidebar {
        position: fixed; top: 56px; left: 0; bottom: 0;
        width: 260px; background: #0e0e16;
        border-right: 1px solid #1e1e2e;
        overflow-y: auto; padding: 20px 0;
        scrollbar-width: thin;
        scrollbar-color: #2a2a3a transparent;
        z-index: 40;
    }
    .doc-sidebar::-webkit-scrollbar { width: 4px; }
    .doc-sidebar::-webkit-scrollbar-thumb { background: #2a2a3a; border-radius: 4px; }

    .nav-group-title {
        padding: 0 20px; margin-bottom: 6px; margin-top: 16px;
        font-size: 11px; font-weight: 700; text-transform: uppercase;
        letter-spacing: 1.2px; color: #55556a;
    }
    .nav-group-title:first-child { margin-top: 0; }

    .nav-link {
        display: block; padding: 5px 20px 5px 24px;
        font-size: 13px; color: #8888a0;
        border-left: 2px solid transparent;
        transition: all 0.15s;
    }
    .nav-link:hover { color: #e4e4ec; background: rgba(255,255,255,0.02); text-decoration: none; }
    .nav-link.active { color: #4f8fff; border-left-color: #4f8fff; background: rgba(79, 143, 255, 0.08); }

    /* Main content */
    .doc-content { margin-left: 260px; max-width: 840px; padding: 40px 48px 120px; }

    .doc-content h2 {
        font-size: 26px; font-weight: 800; letter-spacing: -0.5px;
        margin-top: 80px; margin-bottom: 8px; padding-top: 24px;
        border-top: 1px solid #1e1e2e; color: #e4e4ec;
    }
    .doc-content h2:first-of-type { margin-top: 0; border-top: none; padding-top: 0; }

    .doc-content h3 {
        font-size: 18px; font-weight: 700; margin-top: 40px; margin-bottom: 12px;
        color: #e4e4ec;
    }

    .doc-content h4 {
        font-size: 14px; font-weight: 700; margin-top: 28px; margin-bottom: 8px;
        color: #8888a0; text-transform: uppercase; letter-spacing: 0.5px;
    }

    .doc-content p { margin-bottom: 16px; color: #8888a0; font-size: 15px; line-height: 1.8; }
    .doc-content ul, .doc-content ol { margin-bottom: 16px; padding-left: 24px; color: #8888a0; font-size: 15px; }
    .doc-content li { margin-bottom: 6px; line-height: 1.7; }
    .doc-content strong { color: #e4e4ec; font-weight: 600; }
    .doc-content em { color: #6ba3ff; font-style: normal; }
    .doc-content a { color: #4f8fff; }
    .doc-content a:hover { color: #6ba3ff; text-decoration: underline; }
    .doc-content hr { border: none; border-top: 1px solid #1e1e2e; margin: 48px 0; }

    .doc-content code {
        font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', monospace;
        font-size: 0.88em; background: #12121a; padding: 2px 7px; border-radius: 4px;
        color: #6ba3ff;
    }

    .doc-content pre {
        background: #12121a; border: 1px solid #1e1e2e;
        border-radius: 8px; padding: 16px 20px;
        overflow-x: auto; margin-bottom: 20px;
        font-size: 13px; line-height: 1.75;
    }
    .doc-content pre code {
        background: none; padding: 0; color: #8888a0; font-size: 13px;
    }

    .doc-content table {
        width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px;
    }
    .doc-content th {
        text-align: left; padding: 10px 14px;
        background: #12121a; border: 1px solid #1e1e2e;
        font-weight: 600; color: #e4e4ec; font-size: 13px;
        text-transform: uppercase; letter-spacing: 0.5px;
    }
    .doc-content td {
        padding: 10px 14px; border: 1px solid #1e1e2e; color: #8888a0;
    }
    .doc-content td code { font-size: 12px; }

    .doc-content blockquote {
        padding: 16px 20px; border-radius: 8px;
        margin-bottom: 20px; font-size: 14px;
        border-left: 3px solid #4f8fff;
        background: rgba(79, 143, 255, 0.06);
    }
    .doc-content blockquote p { color: #8888a0; margin: 0; }

    .lead { font-size: 17px; color: #8888a0; margin-bottom: 32px; line-height: 1.8; }

    /* Search trigger */
    .header-search {
        display: flex; align-items: center; gap: 6px;
        padding: 6px 12px; border-radius: 8px; cursor: pointer;
        background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1);
        color: #55556a; font-size: 13px; transition: all 0.15s;
        font-family: inherit;
    }
    .header-search:hover { border-color: rgba(255,255,255,0.2); color: #8888a0; }
    .header-search kbd {
        padding: 1px 5px; border-radius: 3px; font-size: 11px;
        background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1);
    }

    /* Menu button (mobile) */
    .menu-btn { display: none; background: none; border: none; color: #e4e4ec; font-size: 22px; cursor: pointer; padding: 4px; }

    @media (max-width: 900px) {
        .doc-sidebar {
            transform: translateX(-100%); transition: transform 0.25s ease; z-index: 90;
        }
        .doc-sidebar.open { transform: translateX(0); }
        .doc-content { margin-left: 0; padding: 32px 20px 80px; }
        .menu-btn { display: block; }
    }
</style>
{% endblock %}

{% block body %}
{# ── Header ── #}
<header class="fixed top-0 left-0 right-0 z-50 h-14 bg-bg/90 backdrop-blur-xl border-b border-border flex items-center px-6">
    <div class="w-full max-w-[1400px] mx-auto flex items-center justify-between">
        <div class="flex items-center gap-4">
            <button class="menu-btn" onclick="document.querySelector('.doc-sidebar').classList.toggle('open')" aria-label="Menu">☰</button>
            <a href="{{ get_url(path='/') }}" class="flex items-center gap-2 text-gray-200 font-bold text-base hover:text-gray-200 no-underline">⚡ Context Harness</a>
            <span class="text-muted text-lg font-light">/</span>
            <span class="text-dim text-sm font-medium">Documentation</span>
        </div>
        <div class="flex items-center gap-5">
            <button class="header-search" id="search-trigger">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="7"/><path d="m21 21-4.35-4.35"/></svg>
                Search
                <kbd>⌘K</kbd>
            </button>
            <a href="{{ get_url(path='/') }}" class="text-dim text-[13px] font-medium hover:text-gray-200 no-underline">Home</a>
            <a href="/demo/" class="text-dim text-[13px] font-medium hover:text-gray-200 no-underline">Demo</a>
            <a href="{{ config.extra.github_url }}" class="flex items-center opacity-70 hover:opacity-100" target="_blank" rel="noopener">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
            </a>
        </div>
    </div>
</header>

{# ── Sidebar ── #}
<nav class="doc-sidebar" id="sidebar">
    {% set docs_section = get_section(path="docs/_index.md") %}
    {% set_global prev_group = "" %}
    {% for p in docs_section.pages | sort(attribute="extra.sidebar_order") %}
    {% if p.extra.sidebar_label is defined %}
        {% set group = p.extra.sidebar_group | default(value="") %}
        {% if group != prev_group and group != "" %}
            <div class="nav-group-title">{{ group }}</div>
        {% endif %}
        <a class="nav-link" href="#{{ p.slug }}">{{ p.extra.sidebar_label }}</a>
        {% set_global prev_group = group %}
    {% endif %}
    {% endfor %}
</nav>

{# ── Content: All pages rendered as one continuous scroll ── #}
<main class="doc-content" style="margin-top: 56px;">
    <h1 class="text-3xl font-extrabold tracking-tight mb-2">{{ section.title }}</h1>
    <p class="lead">{{ section.description | default(value="") }}</p>

    {{ section.content | safe }}

    {% for page in docs_section.pages | sort(attribute="extra.sidebar_order") %}
    <section id="{{ page.slug }}">
        <h2>{{ page.title }}</h2>
        {% if page.description %}
        <p class="lead" style="margin-bottom: 20px; font-size: 15px;">{{ page.description }}</p>
        {% endif %}
        {{ page.content | safe }}
    </section>
    {% endfor %}
</main>

<script src="{{ get_url(path='ctx-search.js') }}" data-json="{{ get_url(path='docs/data.json') }}" data-trigger="#search-trigger" data-placeholder="Search docs, source code, guides…"></script>
<script>
// Active sidebar tracking on scroll
const sections = document.querySelectorAll('.doc-content section[id]');
const navLinks = document.querySelectorAll('.nav-link');
const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            navLinks.forEach(l => l.classList.remove('active'));
            const link = document.querySelector(`.nav-link[href="#${entry.target.id}"]`);
            if (link) link.classList.add('active');
        }
    });
}, { rootMargin: '-80px 0px -70% 0px' });
sections.forEach(s => observer.observe(s));

// Mobile sidebar close on click
navLinks.forEach(link => {
    link.addEventListener('click', () => {
        document.getElementById('sidebar').classList.remove('open');
    });
});
</script>
{% endblock %}
