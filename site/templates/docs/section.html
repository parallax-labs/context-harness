{% extends "base.html" %}

{% block title %}Documentation — Context Harness{% endblock %}
{% block description %}Complete documentation for Context Harness — local-first context indexing and retrieval for AI tools.{% endblock %}

{% block head_extra %}
<style>
    html { scroll-behavior: smooth; scroll-padding-top: 80px; }

    /* Sidebar */
    .doc-sidebar {
        position: fixed; top: 56px; left: 0; bottom: 0;
        width: 260px; background: #0e0e16;
        border-right: 1px solid #1e1e2e;
        overflow-y: auto; padding: 16px 0;
        scrollbar-width: thin;
        scrollbar-color: #2a2a3a transparent;
        z-index: 40;
    }
    .doc-sidebar::-webkit-scrollbar { width: 4px; }
    .doc-sidebar::-webkit-scrollbar-thumb { background: #2a2a3a; border-radius: 4px; }

    .nav-section {
        margin-bottom: 4px;
    }
    .nav-section-title {
        display: flex; align-items: center; gap: 6px;
        padding: 7px 16px;
        font-size: 13px; font-weight: 700; color: #8888a0;
        user-select: none;
    }
    .nav-section-title .icon { font-size: 14px; }

    .nav-pages {
        padding-bottom: 4px;
    }

    .nav-link {
        display: block; padding: 4px 16px 4px 28px;
        font-size: 13px; color: #55556a;
        border-left: 2px solid transparent;
        transition: all 0.15s;
    }
    .nav-link:hover { color: #e4e4ec; background: rgba(255,255,255,0.02); text-decoration: none; }
    .nav-link.active { color: #4f8fff; border-left-color: #4f8fff; background: rgba(79, 143, 255, 0.06); }

    /* Main content */
    .doc-content { margin-left: 260px; max-width: 900px; padding: 40px 48px 120px; }

    .doc-content h1 {
        font-size: 32px; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 8px;
    }
    .doc-content h2 {
        font-size: 22px; font-weight: 700; margin-top: 48px; margin-bottom: 12px; color: #e4e4ec;
    }
    .doc-content h3 {
        font-size: 17px; font-weight: 700; margin-top: 32px; margin-bottom: 10px; color: #e4e4ec;
    }
    .doc-content h4 {
        font-size: 14px; font-weight: 700; margin-top: 24px; margin-bottom: 8px;
        color: #8888a0; text-transform: uppercase; letter-spacing: 0.5px;
    }
    .doc-content p { margin-bottom: 16px; color: #8888a0; font-size: 15px; line-height: 1.8; }
    .doc-content ul, .doc-content ol { margin-bottom: 16px; padding-left: 24px; color: #8888a0; font-size: 15px; }
    .doc-content li { margin-bottom: 6px; line-height: 1.7; }
    .doc-content strong { color: #e4e4ec; font-weight: 600; }
    .doc-content em { color: #6ba3ff; font-style: normal; }
    .doc-content a { color: #4f8fff; }
    .doc-content a:hover { color: #6ba3ff; text-decoration: underline; }
    .doc-content hr { border: none; border-top: 1px solid #1e1e2e; margin: 40px 0; }

    .doc-content code {
        font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', monospace;
        font-size: 0.88em; background: #12121a; padding: 2px 7px; border-radius: 4px;
        color: #6ba3ff;
    }
    .doc-content pre {
        background: #12121a; border: 1px solid #1e1e2e;
        border-radius: 8px; padding: 16px 20px;
        overflow-x: auto; margin-bottom: 20px;
        font-size: 13px; line-height: 1.75;
    }
    .doc-content pre code { background: none; padding: 0; color: #8888a0; font-size: 13px; }

    .doc-content table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px; }
    .doc-content th {
        text-align: left; padding: 10px 14px;
        background: #12121a; border: 1px solid #1e1e2e;
        font-weight: 600; color: #e4e4ec; font-size: 13px;
        text-transform: uppercase; letter-spacing: 0.5px;
    }
    .doc-content td { padding: 10px 14px; border: 1px solid #1e1e2e; color: #8888a0; }
    .doc-content td code { font-size: 12px; }

    .doc-content blockquote {
        padding: 16px 20px; border-radius: 8px; margin-bottom: 20px; font-size: 14px;
        border-left: 3px solid #4f8fff; background: rgba(79, 143, 255, 0.06);
    }
    .doc-content blockquote p { color: #8888a0; margin: 0; }

    .lead { font-size: 17px; color: #8888a0; margin-bottom: 32px; line-height: 1.8; }

    /* Section cards on landing */
    .section-grid {
        display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 32px;
    }
    .section-card {
        background: #12121a; border: 1px solid #1e1e2e; border-radius: 12px;
        padding: 24px; transition: all 0.2s; display: block; text-decoration: none;
    }
    .section-card:hover {
        border-color: #2a2a3a; background: #1a1a25; transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0,0,0,0.3); text-decoration: none;
    }
    .section-card-icon { font-size: 28px; margin-bottom: 12px; }
    .section-card h3 { font-size: 18px; font-weight: 700; margin-bottom: 6px; color: #e4e4ec; }
    .section-card p { font-size: 14px; color: #55556a; line-height: 1.6; margin: 0; }
    .section-card-pages { margin-top: 12px; display: flex; flex-wrap: wrap; gap: 6px; }
    .section-card-pages span {
        padding: 3px 10px; background: #0a0a0f; border: 1px solid #1e1e2e;
        border-radius: 100px; font-size: 11px; color: #55556a; font-family: 'JetBrains Mono', monospace;
    }

    /* Search trigger */
    .header-search {
        display: flex; align-items: center; gap: 6px;
        padding: 6px 12px; border-radius: 8px; cursor: pointer;
        background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1);
        color: #55556a; font-size: 13px; transition: all 0.15s; font-family: inherit;
    }
    .header-search:hover { border-color: rgba(255,255,255,0.2); color: #8888a0; }
    .header-search kbd {
        padding: 1px 5px; border-radius: 3px; font-size: 11px;
        background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1);
    }

    .menu-btn { display: none; background: none; border: none; color: #e4e4ec; font-size: 22px; cursor: pointer; padding: 4px; }

    @media (max-width: 900px) {
        .doc-sidebar { transform: translateX(-100%); transition: transform 0.25s ease; z-index: 90; }
        .doc-sidebar.open { transform: translateX(0); }
        .doc-content { margin-left: 0; padding: 32px 20px 80px; }
        .menu-btn { display: block; }
        .section-grid { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}

{% block body %}
{# ── Header ── #}
{% set show_search = true %}
{% set show_menu_btn = true %}
{% set brand_slash = "Documentation" %}
<header class="fixed top-0 left-0 right-0 z-50 h-14 bg-bg/90 backdrop-blur-xl border-b border-border flex items-center px-6">
    <div class="w-full max-w-[1400px] mx-auto flex items-center justify-between">
        {% include "partials/site_header.html" with context %}
    </div>
</header>

{# ── Sidebar ── #}
<nav class="doc-sidebar" id="sidebar">
    {% set docs = get_section(path="docs/_index.md") %}
    {% for sub_path in docs.subsections %}
        {% set sub = get_section(path=sub_path) %}
        <div class="nav-section">
            <div class="nav-section-title">
                {% if sub.extra.sidebar_icon %}<span class="icon">{{ sub.extra.sidebar_icon }}</span>{% endif %}
                {{ sub.title }}
            </div>
            <div class="nav-pages">
                {% for page in sub.pages %}
                <a class="nav-link" href="{{ page.permalink }}">{{ page.title }}</a>
                {% endfor %}
            </div>
        </div>
    {% endfor %}
</nav>

{# ── Main Content: Docs Landing ── #}
<main class="doc-content" style="margin-top: 56px;">
    <h1>{{ section.title }}</h1>
    <p class="lead">{{ section.description | default(value="") }}</p>

    {{ section.content | safe }}

    <div class="section-grid">
        {% for sub_path in docs.subsections %}
            {% set sub = get_section(path=sub_path) %}
            {% set first_page = sub.pages | first %}
            <a class="section-card" href="{% if first_page %}{{ first_page.permalink }}{% else %}{{ sub.permalink }}{% endif %}">
                {% if sub.extra.sidebar_icon %}<div class="section-card-icon">{{ sub.extra.sidebar_icon }}</div>{% endif %}
                <h3>{{ sub.title }}</h3>
                <p>{{ sub.description | default(value="") }}</p>
                <div class="section-card-pages">
                    {% for page in sub.pages %}
                    <span>{{ page.title }}</span>
                    {% endfor %}
                </div>
            </a>
        {% endfor %}
    </div>
</main>

<script src="{{ get_url(path='ctx-search.js') }}" data-json="{{ get_url(path='docs/data.json') }}" data-site-index="{{ get_url(path='site-index.json') }}" data-trigger="#search-trigger" data-placeholder="Search docs and site…"></script>
<script>
document.querySelector('.doc-sidebar').addEventListener('click', e => {
    if (e.target.classList.contains('nav-link')) {
        document.getElementById('sidebar').classList.remove('open');
    }
});
</script>
{% endblock %}
